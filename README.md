- [actix web static files example](https://github.com/actix/examples/tree/c42b85587dd6f6606d4d21921d02ca565e5d683a/basics/static-files)
- [HTML validator](https://validator.w3.org/)
```sh
curl http://127.0.0.1:3001/signup \
     -d "username=username&password=password"
```
- [actix forms extractor example](https://github.com/actix/examples/blob/c42b85587dd6f6606d4d21921d02ca565e5d683a/forms/form/src/main.rs)
- [setting up rustls example](https://github.com/actix/examples/blob/c42b85587dd6f6606d4d21921d02ca565e5d683a/https-tls/rustls/src/main.rs)
```sh
curl -v https://127.0.0.1:3000/index.html --compressed -k
# -k is shorthand for --insecure
```
```sh
curl -v https://127.0.0.1:3001/signup \
    -d "username=username&password=password" \
    --cacert ./cert.pem 
```
- mTLS seems also possible
- [PR](https://github.com/actix/actix-web/issues/1727)
- [implementation example](https://github.com/actix/examples/blob/master/https-tls/rustls-client-cert/src/main.rs)
- [jwt crate](https://github.com/Keats/jsonwebtoken)
- [from_fn middleware example](https://github.com/LukeMathWalker/zero-to-production/blob/970987c5f793af6fc8e557731c9bbb23b620451e/src/authentication/middleware.rs#L28)
- [websocket echo server example](https://github.com/actix/examples/blob/master/websockets/echo-actorless/src/handler.rs)
- [html page to test ws](https://github.com/actix/examples/blob/master/websockets/echo/static/index.html)
- [grpc via tonic hello world](https://github.com/hyperium/tonic/blob/master/examples/helloworld-tutorial.md)
- [stackoverflow on how to derive on generated by tonic-build structs](https://stackoverflow.com/questions/73090493/tonic-build-add-use-external-crates-like-serde)
- [tonic build examples](https://github.com/hyperium/tonic/blob/master/examples/build.rs)
```sh
grpcurl -plaintext \
    -H "authorization: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiI2NTRiNDRiOS00MzAwLTQ5ODItODZkOS1jYTQ1YjUyZDQwZGQiLCJleHAiOjE3Mjc2MzA5MTJ9.g1EDo5LDzOzwoLAZk5h3nZMmkff-3WwLz12JK8lUelA" \
    -import-path ../common/proto \
    -proto inventory.proto \
    -d '' \
    '[::1]:50051' \
    inventory.InventoryService/GetStock
```
- cloning the `Channel` type is cheap and encouraged
- [interceptor example build, how to reuse client](https://github.com/hyperium/tonic/blob/master/examples/src/interceptor/client.rs)
- [rabbitmq tutorial (javascript)](https://www.rabbitmq.com/tutorials/tutorial-one-javascript)
- [lapin translation](https://github.com/rabbitmq/rabbitmq-tutorials/tree/main/rust-lapin)
- [grpc schema evolution article](https://softwaremill.com/schema-evolution-protobuf-scalapb-fs2grpc/)
- [rpc request/reply or direct reply-to](https://www.rabbitmq.com/docs/direct-reply-to)
- [enterprise integration patterns](https://www.enterpriseintegrationpatterns.com/patterns/messaging/RequestReply.html)
- [getting started distroless containers](https://edu.chainguard.dev/chainguard/chainguard-images/getting-started-distroless/)

### Garage wlaktrough documentation

- [building garage from source](https://garagehq.deuxfleurs.fr/documentation/cookbook/from-source/)
- it's easier to mess around with binary cause docker image is `FROM scratch`
- make sure to install `mold` linker! error mention `clang` only which might be missleading
- `garage -c ./garage.toml server`
- `garage -c ./garage.toml status` once running we still have to precise the config
- `garage -c ./garage.toml layout assign -z dc1 -c 1G f3f676a26fe56979` we create a single node here
- `garage -c ./garage.toml layout apply`
- `garage -c ./garage.toml bucket create image-bucket`
- `garage -c ./garage.toml key create image-app-key`
```sh
$ garage -c ./garage.toml key create image-app-key
Key name: image-app-key
Key ID: GK098e34fb7f80e87921fc9b72
Secret key: dd173761470b179f7354f513af0e699f460bb3d2e13647fe9fbe92e3b1ab8e99
Can create buckets: false

Key-specific bucket aliases:

Authorized buckets:
```
```sh
garage -c ./garage.toml bucket allow \
  --read \
  --write \
  --owner \
  image-bucket \
  --key image-app-key
```
```sh
garage -c ./garage.toml bucket info image-bucket
```
- `python -m pip install --user awscli`
- `source .awsrc`
- `aws s3 ls s3://image-bucket`
- `aws s3 cp /proc/cpuinfo s3://image-bucket/cpuinfo.txt`

### Single node minio client

```sh
sudo groupadd -r minio-user
sudo useradd -M -r -g minio-user minio-user
sudo mkdir -p /mnt/data
sudo chown minio-user:minio-user /mnt/data

touch /etc/default/minio
```
```sh
# MINIO_ROOT_USER and MINIO_ROOT_PASSWORD sets the root account for the MinIO server.
# This user has unrestricted permissions to perform S3 and administrative API operations on any resource in the deployment.
# Omit to use the default values 'minioadmin:minioadmin'.
# MinIO recommends setting non-default values as a best practice, regardless of environment

MINIO_ROOT_USER=myminioadmin
MINIO_ROOT_PASSWORD=minio-secret-key-change-me

# MINIO_VOLUMES sets the storage volume or path to use for the MinIO server.

MINIO_VOLUMES="/mnt/data"

# MINIO_OPTS sets any additional commandline options to pass to the MinIO server.
# For example, `--console-address :9001` sets the MinIO Console listen port
MINIO_OPTS="--console-address :9001"
```
- `sudo systemctl start minio.service` finally start the service
- confirm that it worked
```sh
sudo systemctl status minio.service
journalctl -f -u minio.service
```
- http://localhost:9001

### plug them togetehr

```sh
wget https://dl.min.io/client/mc/release/linux-amd64/mc
chmod +x mc
sudo mv mc /usr/local/bin/
```
- `mc alias set garage http://localhost:3900 GK098e34fb7f80e87921fc9b72 dd173761470b179f7354f513af0e699f460bb3d2e13647fe9fbe92e3b1ab8e99 --api S3v4`
```sh
$ mc ls garage
[2024-10-10 17:39:45 CEST]     0B image-bucket/
$ mc ls garage/image-bucket
[2024-10-10 20:00:14 CEST]     0B STANDARD cpuinfo.txt
```

### image service
- [aws sdk examples](https://docs.aws.amazon.com/sdk-for-rust/latest/dg/rust_s3_code_examples.html)
- aws setup
```sh
cargo add aws-config aws-sdk-dynamodb tokio --features tokio/full
```
- [example of garage usage with aws client](https://gitlab.com/turbomarktplatz/turbobilder/-/blob/main/src/main.rs?ref_type=heads)
- `cargo watch -q -w src -x 'r -- --verbose --bucket image-bucket --filename ./solid-grey.jpg --key solid-grey.jpg'`
- upload/download
```sh
$ sha256sum dl-this-test.txt solid-grey.jpg
ad44b97ba0ba348070341a02c2d8f720f92592f146df9dc0a873c8848e66ca66  dl-this-test.txt
ad44b97ba0ba348070341a02c2d8f720f92592f146df9dc0a873c8848e66ca66  solid-grey.jpg
```
- [tonic streaming example](https://github.com/hyperium/tonic/blob/master/examples/proto/echo/echo.proto)
- [actix multipart](https://docs.rs/actix-multipart/latest/actix_multipart/)
- stream file via grpc
```sh
$ curl -X POST https://127.0.0.1:3001/images/upload -F "file=@solid-grey.jpg"
$ sha256sum solid-grey.jpg uploaded_image.bin
ad44b97ba0ba348070341a02c2d8f720f92592f146df9dc0a873c8848e66ca66  solid-grey.jpg
ad44b97ba0ba348070341a02c2d8f720f92592f146df9dc0a873c8848e66ca66  uploaded_image.bin
```
```sh
$ free -h
               total        used        free      shared  buff/cache   available
Mem:            14Gi       5.4Gi       1.8Gi       331Mi       7.8Gi       8.2Gi
Swap:           32Gi          0B        32Gi

$ dd if=/dev/urandom of=largefile.bin bs=1G count=14

$ curl -X POST https://127.0.0.1:3001/images/upload -F "file=@largefile.bin"

$ sha256sum largefile.bin uploaded_image.bin
2fd849f9c7e393b5e6eaffec3c34580eacabba9c165c84627f48087c29753be3  largefile.bin
2fd849f9c7e393b5e6eaffec3c34580eacabba9c165c84627f48087c29753be3  uploaded_image.bin

```
- [run garage from the docker and configure it remotely, real world scenario](https://garagehq.deuxfleurs.fr/documentation/cookbook/real-world/)
- alias local `garage` bin to interact with remove
- this time assign enough of memory for the streaming test `grg layout assign -z dc1 -c 32G c6a14b8d749b105d`
```sh
$ grg key create image-app-key
2024-10-12T17:59:20.890829Z  INFO garage_net::netapp: Connected to 127.0.0.1:3901, negotiating handshake...
2024-10-12T17:59:20.932527Z  INFO garage_net::netapp: Connection established to c6a14b8d749b105d
Key name: image-app-key
Key ID: GK9c8c1eae131284d958414724
Secret key: 4a8a7d97c82ebc46b64182bad0e38313280e736770fe508f923e8a1cb9b673f2
Can create buckets: false

Key-specific bucket aliases:

Authorized buckets:
```
- [multipart data on mdn](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest_API/Using_FormData_Objects)
```text
Warning: When using FormData to submit POST requests using XMLHttpRequest or the Fetch API with the multipart/form-data content type (e.g. when uploading files and blobs to the server), do not explicitly set the Content-Type header on the request.
```

# fun things to try:

- https://garagehq.deuxfleurs.fr/ open cloud object storage a la S3
- distroless images
- PKCE
- BFF (backed for frontned)
- searchable encryption
- multi-key encryption (never access data)

